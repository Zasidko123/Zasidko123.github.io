<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        .test-button {
            background: #4facfe;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .info { background: rgba(33, 150, 243, 0.3); }
        .warning { background: rgba(255, 193, 7, 0.3); }
        
        .chat-preview {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .message-preview {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 15px;
            display: inline-block;
            max-width: 80%;
        }
        
        .message-preview.own {
            background: rgba(102, 126, 234, 0.3);
            margin-left: auto;
            display: block;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ChatApp</h1>
    
    <div class="test-section">
        <h2>üìã –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
        <button class="test-button" onclick="createMultipleUsers()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
        <button class="test-button" onclick="showAllUsers()">–ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
        <div id="usersStatus"></div>
    </div>

    <div class="test-section">
        <h2>üí¨ –¢–µ—Å—Ç –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</h2>
        <button class="test-button" onclick="createPrivateMessages()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
        <button class="test-button" onclick="showPrivateMessages()">–ü–æ–∫–∞–∑–∞—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
        <button class="test-button" onclick="clearPrivateMessages()">–û—á–∏—Å—Ç–∏—Ç–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
        <div id="privateMessagesStatus"></div>
    </div>

    <div class="test-section">
        <h2>üîç –¢–µ—Å—Ç –ø–æ—à—É–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h2>
        <input type="text" id="searchInput" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞..." style="padding: 8px; margin-right: 10px; border-radius: 5px; border: none;">
        <button class="test-button" onclick="searchUsers()">–ü–æ—à—É–∫</button>
        <div id="searchResults"></div>
    </div>

    <div class="test-section">
        <h2>üöÄ –ó–∞–ø—É—Å–∫ —á–∞—Ç—É</h2>
        <button class="test-button" onclick="openChatAsUser1()">–í—ñ–¥–∫—Ä–∏—Ç–∏ —è–∫ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á1</button>
        <button class="test-button" onclick="openChatAsUser2()">–í—ñ–¥–∫—Ä–∏—Ç–∏ —è–∫ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á2</button>
        <button class="test-button" onclick="openChatAsUser3()">–í—ñ–¥–∫—Ä–∏—Ç–∏ —è–∫ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á3</button>
        <div id="chatStatus"></div>
    </div>

    <div class="test-section">
        <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏</h2>
        <div id="systemStatus"></div>
    </div>

    <script>
        function createMultipleUsers() {
            const testUsers = [
                {
                    id: '1',
                    username: '–ê–Ω–Ω–∞',
                    email: 'anna@example.com',
                    password: '123456',
                    createdAt: new Date().toISOString(),
                    lastSeen: new Date().toISOString(),
                    isOnline: true
                },
                {
                    id: '2',
                    username: '–ë–æ–≥–¥–∞–Ω',
                    email: 'bogdan@example.com',
                    password: '123456',
                    createdAt: new Date().toISOString(),
                    lastSeen: new Date().toISOString(),
                    isOnline: true
                },
                {
                    id: '3',
                    username: '–ú–∞—Ä—ñ—è',
                    email: 'maria@example.com',
                    password: '123456',
                    createdAt: new Date().toISOString(),
                    lastSeen: new Date().toISOString(),
                    isOnline: true
                },
                {
                    id: '4',
                    username: '–û–ª–µ–∫—Å–∞–Ω–¥—Ä',
                    email: 'oleksandr@example.com',
                    password: '123456',
                    createdAt: new Date().toISOString(),
                    lastSeen: new Date().toISOString(),
                    isOnline: false
                }
            ];
            
            localStorage.setItem('chatUsers', JSON.stringify(testUsers));
            document.getElementById('usersStatus').innerHTML = `
                <div class="status success">‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ ${testUsers.length} —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>
            `;
        }

        function showAllUsers() {
            const users = JSON.parse(localStorage.getItem('chatUsers')) || [];
            const status = document.getElementById('usersStatus');
            
            if (users.length === 0) {
                status.innerHTML = '<div class="status info">‚ÑπÔ∏è –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ–º–∞—î</div>';
                return;
            }
            
            const usersList = users.map(user => 
                `<li>${user.username} (${user.email}) - ${user.isOnline ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω'}</li>`
            ).join('');
            
            status.innerHTML = `
                <div class="status success">
                    <strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (${users.length}):</strong>
                    <ul>${usersList}</ul>
                </div>
            `;
        }

        function createPrivateMessages() {
            // Create private messages between users
            const chatId1_2 = ['1', '2'].sort().join('_');
            const chatId1_3 = ['1', '3'].sort().join('_');
            const chatId2_3 = ['2', '3'].sort().join('_');
            
            const privateMessages1_2 = [
                {
                    id: '1',
                    text: '–ü—Ä–∏–≤—ñ—Ç, –ë–æ–≥–¥–∞–Ω! –Ø–∫ —Å–ø—Ä–∞–≤–∏? üòä',
                    userId: '1',
                    username: '–ê–Ω–Ω–∞',
                    timestamp: new Date(Date.now() - 300000).toISOString(),
                    type: 'private',
                    targetUserId: '2',
                    chatId: chatId1_2
                },
                {
                    id: '2',
                    text: '–ü—Ä–∏–≤—ñ—Ç, –ê–Ω–Ω–∞! –í—Å–µ –¥–æ–±—Ä–µ, –¥—è–∫—É—é! üëç',
                    userId: '2',
                    username: '–ë–æ–≥–¥–∞–Ω',
                    timestamp: new Date(Date.now() - 200000).toISOString(),
                    type: 'private',
                    targetUserId: '1',
                    chatId: chatId1_2
                },
                {
                    id: '3',
                    text: '–ß—É–¥–æ–≤–æ! –ú–æ–∂–µ –∑—É—Å—Ç—Ä—ñ–Ω–µ–º–æ—Å—å —Å—å–æ–≥–æ–¥–Ω—ñ?',
                    userId: '1',
                    username: '–ê–Ω–Ω–∞',
                    timestamp: new Date(Date.now() - 100000).toISOString(),
                    type: 'private',
                    targetUserId: '2',
                    chatId: chatId1_2
                }
            ];
            
            const privateMessages1_3 = [
                {
                    id: '4',
                    text: '–ú–∞—Ä—ñ—è, –ø—Ä–∏–≤—ñ—Ç! üëã',
                    userId: '1',
                    username: '–ê–Ω–Ω–∞',
                    timestamp: new Date(Date.now() - 150000).toISOString(),
                    type: 'private',
                    targetUserId: '3',
                    chatId: chatId1_3
                }
            ];
            
            localStorage.setItem(`privateMessages_${chatId1_2}`, JSON.stringify(privateMessages1_2));
            localStorage.setItem(`privateMessages_${chatId1_3}`, JSON.stringify(privateMessages1_3));
            
            document.getElementById('privateMessagesStatus').innerHTML = `
                <div class="status success">
                    ‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –º—ñ–∂ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏<br>
                    –ê–Ω–Ω–∞ ‚Üî –ë–æ–≥–¥–∞–Ω: ${privateMessages1_2.length} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å<br>
                    –ê–Ω–Ω–∞ ‚Üî –ú–∞—Ä—ñ—è: ${privateMessages1_3.length} –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
                </div>
            `;
        }

        function showPrivateMessages() {
            const chatId1_2 = ['1', '2'].sort().join('_');
            const chatId1_3 = ['1', '3'].sort().join('_');
            
            const messages1_2 = JSON.parse(localStorage.getItem(`privateMessages_${chatId1_2}`)) || [];
            const messages1_3 = JSON.parse(localStorage.getItem(`privateMessages_${chatId1_3}`)) || [];
            
            const status = document.getElementById('privateMessagesStatus');
            
            let html = '<div class="status info"><strong>–ü—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong></div>';
            
            if (messages1_2.length > 0) {
                html += '<div class="chat-preview"><h4>–ê–Ω–Ω–∞ ‚Üî –ë–æ–≥–¥–∞–Ω:</h4>';
                messages1_2.forEach(msg => {
                    const isOwn = msg.userId === '1';
                    html += `<div class="message-preview ${isOwn ? 'own' : ''}">
                        <strong>${msg.username}:</strong> ${msg.text}
                        <br><small>${new Date(msg.timestamp).toLocaleTimeString()}</small>
                    </div>`;
                });
                html += '</div>';
            }
            
            if (messages1_3.length > 0) {
                html += '<div class="chat-preview"><h4>–ê–Ω–Ω–∞ ‚Üî –ú–∞—Ä—ñ—è:</h4>';
                messages1_3.forEach(msg => {
                    const isOwn = msg.userId === '1';
                    html += `<div class="message-preview ${isOwn ? 'own' : ''}">
                        <strong>${msg.username}:</strong> ${msg.text}
                        <br><small>${new Date(msg.timestamp).toLocaleTimeString()}</small>
                    </div>`;
                });
                html += '</div>';
            }
            
            status.innerHTML = html;
        }

        function clearPrivateMessages() {
            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('privateMessages_')) {
                    localStorage.removeItem(key);
                }
            });
            document.getElementById('privateMessagesStatus').innerHTML = `
                <div class="status warning">üóëÔ∏è –í—Å—ñ –ø—Ä–∏–≤–∞—Ç–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –æ—á–∏—â–µ–Ω–æ</div>
            `;
        }

        function searchUsers() {
            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            const users = JSON.parse(localStorage.getItem('chatUsers')) || [];
            const results = document.getElementById('searchResults');
            
            if (!searchTerm) {
                results.innerHTML = '<div class="status info">‚ÑπÔ∏è –í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ—à—É–∫—É</div>';
                return;
            }
            
            const filteredUsers = users.filter(user => 
                user.username.toLowerCase().includes(searchTerm) ||
                user.email.toLowerCase().includes(searchTerm)
            );
            
            if (filteredUsers.length === 0) {
                results.innerHTML = '<div class="status warning">üîç –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }
            
            const usersList = filteredUsers.map(user => 
                `<li>${user.username} (${user.email}) - ${user.isOnline ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω'}</li>`
            ).join('');
            
            results.innerHTML = `
                <div class="status success">
                    <strong>–ó–Ω–∞–π–¥–µ–Ω–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (${filteredUsers.length}):</strong>
                    <ul>${usersList}</ul>
                </div>
            `;
        }

        function openChatAsUser(userId) {
            const users = JSON.parse(localStorage.getItem('chatUsers')) || [];
            const user = users.find(u => u.id === userId);
            
            if (!user) {
                document.getElementById('chatStatus').innerHTML = `
                    <div class="status error">‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>
                `;
                return;
            }
            
            localStorage.setItem('currentUser', JSON.stringify({
                id: user.id,
                username: user.username,
                email: user.email
            }));
            
            window.open('chat.html', '_blank');
            
            document.getElementById('chatStatus').innerHTML = `
                <div class="status success">‚úÖ –í—ñ–¥–∫—Ä–∏—Ç–æ —á–∞—Ç —è–∫ ${user.username}</div>
            `;
        }

        function openChatAsUser1() { openChatAsUser('1'); }
        function openChatAsUser2() { openChatAsUser('2'); }
        function openChatAsUser3() { openChatAsUser('3'); }

        // Auto-check system status
        function updateSystemStatus() {
            const status = document.getElementById('systemStatus');
            const users = JSON.parse(localStorage.getItem('chatUsers')) || [];
            const currentUser = localStorage.getItem('currentUser');
            
            // Count private messages
            const keys = Object.keys(localStorage);
            const privateMessageKeys = keys.filter(key => key.startsWith('privateMessages_'));
            let totalPrivateMessages = 0;
            privateMessageKeys.forEach(key => {
                const messages = JSON.parse(localStorage.getItem(key)) || [];
                totalPrivateMessages += messages.length;
            });
            
            status.innerHTML = `
                <div class="status info">
                    <strong>–°–∏—Å—Ç–µ–º–Ω–∏–π —Å—Ç–∞—Ç—É—Å:</strong><br>
                    üìä –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤: ${users.length}<br>
                    üí¨ –ü—Ä–∏–≤–∞—Ç–Ω–∏—Ö —á–∞—Ç—ñ–≤: ${privateMessageKeys.length}<br>
                    üíå –ü—Ä–∏–≤–∞—Ç–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: ${totalPrivateMessages}<br>
                    üë§ –ê–∫—Ç–∏–≤–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${currentUser ? JSON.parse(currentUser).username : '–ù—ñ'}<br>
                    üìÖ –ß–∞—Å: ${new Date().toLocaleString('uk-UA')}
                </div>
            `;
        }

        // Initialize
        updateSystemStatus();
        setInterval(updateSystemStatus, 5000);
    </script>
</body>
</html> 