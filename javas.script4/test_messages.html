<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .test-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
        }
        .success { border-color: #28a745; background-color: #d4edda; }
        .error { border-color: #dc3545; background-color: #f8d7da; }
        .info { border-color: #17a2b8; background-color: #d1ecf1; }
        
        button {
            padding: 12px 20px;
            margin: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .btn-primary { background-color: #667eea; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-warning { background-color: #ffc107; color: black; }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        
        .message-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .message-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .message-username {
            font-weight: bold;
            color: #667eea;
        }
        
        .message-time {
            color: #6c757d;
        }
        
        .message-content {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .own-message .message-content {
            background: #667eea;
            color: white;
            border-left-color: #764ba2;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üí¨ –¢–µ—Å—Ç –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h1>
        
        <div class="test-section info">
            <h3>üéØ –©–æ —Ç–µ—Å—Ç—É—î–º–æ:</h3>
            <ul>
                <li>–í—ñ–¥–ø—Ä–∞–≤–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</li>
                <li>–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–º–µ–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</li>
                <li>–í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–∞—Å—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</li>
                <li>–†—ñ–∑–Ω—ñ —Ç–∏–ø–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å (–≥—Ä—É–ø–æ–≤—ñ/–ø—Ä–∏–≤–∞—Ç–Ω—ñ)</li>
                <li>Emoji –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</h3>
            <button class="btn-primary" onclick="createTestUsers()">–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
            <button class="btn-success" onclick="checkUsers()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</button>
            <div id="usersStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>2. –¢–µ—Å—Ç –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</h3>
            <button class="btn-primary" onclick="addTestMessage()">–î–æ–¥–∞—Ç–∏ —Ç–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
            <button class="btn-warning" onclick="addMultipleMessages()">–î–æ–¥–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</button>
            <button class="btn-success" onclick="checkMessages()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</button>
            <div id="messageStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>3. –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å</h3>
            <div id="messagePreview"></div>
        </div>

        <div class="test-section">
            <h3>4. –¢–µ—Å—Ç emoji</h3>
            <button class="btn-primary" onclick="addEmojiMessage()">–î–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ emoji</button>
            <div id="emojiStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>5. –í—ñ–¥–∫—Ä–∏—Ç—Ç—è —á–∞—Ç—É</h3>
            <button class="btn-primary" onclick="openChat()">–í—ñ–¥–∫—Ä–∏—Ç–∏ —á–∞—Ç</button>
            <button class="btn-success" onclick="openTestPage()">–í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª</button>
            <div id="chatStatus" class="status"></div>
        </div>

        <div class="test-section">
            <h3>6. –û—á–∏—â–µ–Ω–Ω—è</h3>
            <button class="btn-danger" onclick="clearData()">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ</button>
            <div id="clearStatus" class="status"></div>
        </div>
    </div>

    <script>
        function createTestUsers() {
            try {
                const testUsers = [
                    { username: '–ê–Ω–Ω–∞', id: 'user-1' },
                    { username: '–ë–æ–≥–¥–∞–Ω', id: 'user-2' },
                    { username: '–ú–∞—Ä—ñ—è', id: 'user-3' },
                    { username: '–û–ª–µ–∫—Å–∞–Ω–¥—Ä', id: 'user-4' },
                    { username: '–Æ–ª—ñ—è', id: 'user-5' }
                ];

                const users = testUsers.map(user => ({
                    ...user,
                    isOnline: true,
                    lastSeen: new Date().toISOString(),
                    createdAt: new Date().toISOString()
                }));

                localStorage.setItem('chatUsers', JSON.stringify(users));
                
                // Set current user
                const currentUser = {
                    id: 'current-user',
                    username: '–¢–µ—Å—Ç–æ–≤–∏–π–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));

                document.getElementById('usersStatus').innerHTML = 
                    '<div class="success">‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ ' + users.length + ' —Ç–µ—Å—Ç–æ–≤–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>';
                    
            } catch (error) {
                document.getElementById('usersStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function checkUsers() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const users = JSON.parse(localStorage.getItem('chatUsers')) || [];
                
                let status = '<div class="info">';
                status += '<strong>–ü–æ—Ç–æ—á–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong> ' + (currentUser ? currentUser.username : '–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ') + '<br>';
                status += '<strong>–í—Å—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:</strong> ' + users.length + '<br>';
                status += '<strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ:</strong><br>';
                users.forEach(user => {
                    status += '‚Ä¢ ' + user.username + ' (' + (user.isOnline ? '–æ–Ω–ª–∞–π–Ω' : '–æ—Ñ–ª–∞–π–Ω') + ')<br>';
                });
                status += '</div>';
                
                document.getElementById('usersStatus').innerHTML = status;
                
            } catch (error) {
                document.getElementById('usersStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function addTestMessage() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    document.getElementById('messageStatus').innerHTML = 
                        '<div class="error">‚ùå –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</div>';
                    return;
                }

                const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
                const newMessage = {
                    id: Date.now().toString(),
                    text: '–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ ' + new Date().toLocaleTimeString(),
                    userId: currentUser.id,
                    username: currentUser.username,
                    timestamp: new Date().toISOString(),
                    type: 'message'
                };

                messages.push(newMessage);
                localStorage.setItem('chatMessages', JSON.stringify(messages));

                document.getElementById('messageStatus').innerHTML = 
                    '<div class="success">‚úÖ –¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–¥–∞–Ω–æ</div>';
                
                updateMessagePreview();
                
            } catch (error) {
                document.getElementById('messageStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function addMultipleMessages() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const users = JSON.parse(localStorage.getItem('chatUsers')) || [];
                
                if (!currentUser || users.length === 0) {
                    document.getElementById('messageStatus').innerHTML = 
                        '<div class="error">‚ùå –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>';
                    return;
                }

                const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
                const testMessages = [
                    { username: currentUser.username, text: '–ü—Ä–∏–≤—ñ—Ç –≤—Å—ñ–º! üëã' },
                    { username: users[0].username, text: '–ü—Ä–∏–≤—ñ—Ç! –Ø–∫ —Å–ø—Ä–∞–≤–∏? :)' },
                    { username: currentUser.username, text: '–í—Å–µ –¥–æ–±—Ä–µ, –¥—è–∫—É—é! üòä' },
                    { username: users[1].username, text: '–†–∞–¥–∏–π –±–∞—á–∏—Ç–∏ –≤–∞—Å —Ç—É—Ç! üéâ' },
                    { username: users[2].username, text: '–ß—É–¥–æ–≤–∏–π —á–∞—Ç! ‚ù§Ô∏è' }
                ];

                testMessages.forEach((msg, index) => {
                    const newMessage = {
                        id: (Date.now() + index).toString(),
                        text: msg.text,
                        userId: msg.username === currentUser.username ? currentUser.id : users.find(u => u.username === msg.username)?.id || 'unknown',
                        username: msg.username,
                        timestamp: new Date(Date.now() + index * 1000).toISOString(),
                        type: 'message'
                    };
                    messages.push(newMessage);
                });

                localStorage.setItem('chatMessages', JSON.stringify(messages));

                document.getElementById('messageStatus').innerHTML = 
                    '<div class="success">‚úÖ –î–æ–¥–∞–Ω–æ ' + testMessages.length + ' –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ —Ä—ñ–∑–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>';
                
                updateMessagePreview();
                
            } catch (error) {
                document.getElementById('messageStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function addEmojiMessage() {
            try {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    document.getElementById('emojiStatus').innerHTML = 
                        '<div class="error">‚ùå –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</div>';
                    return;
                }

                const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
                const emojiTexts = [
                    '–ü—Ä–∏–≤—ñ—Ç :) —è–∫ —Å–ø—Ä–∞–≤–∏?',
                    '–Ø —Å—É–º—É—é :(',
                    '–¶–µ –∫—Ä—É—Ç–æ :D',
                    '–ü—ñ–¥–º–æ—Ä–≥–Ω—É–≤ ;)',
                    '–õ—é–±–ª—é —Ç–µ–±–µ <3',
                    '–°–º–∞–π–ª–∏–∫ :P',
                    '–ó–¥–∏–≤–æ–≤–∞–Ω–∏–π :O',
                    '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∏–π :|'
                ];

                const randomText = emojiTexts[Math.floor(Math.random() * emojiTexts.length)];
                const convertedText = convertEmojis(randomText);

                const newMessage = {
                    id: Date.now().toString(),
                    text: randomText,
                    userId: currentUser.id,
                    username: currentUser.username,
                    timestamp: new Date().toISOString(),
                    type: 'message'
                };

                messages.push(newMessage);
                localStorage.setItem('chatMessages', JSON.stringify(messages));

                document.getElementById('emojiStatus').innerHTML = 
                    '<div class="success">‚úÖ –î–æ–¥–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ emoji: "' + randomText + '" ‚Üí "' + convertedText + '"</div>';
                
                updateMessagePreview();
                
            } catch (error) {
                document.getElementById('emojiStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function convertEmojis(text) {
            const emojiMap = {
                ':\\)': 'üòä', ':\\(': 'üò¢', ':D': 'üòÉ', ';\\)': 'üòâ',
                '<3': '‚ù§Ô∏è', ':P': 'üòõ', ':O': 'üòÆ', ':\\|': 'üòê'
            };
            
            Object.keys(emojiMap).forEach(shortcut => {
                text = text.replace(new RegExp(shortcut, 'g'), emojiMap[shortcut]);
            });
            
            return text;
        }

        function checkMessages() {
            try {
                const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                
                let status = '<div class="info">';
                status += '<strong>–í—Å—å–æ–≥–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:</strong> ' + messages.length + '<br>';
                status += '<strong>–û—Å—Ç–∞–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong><br>';
                
                messages.slice(-5).forEach(msg => {
                    const isOwn = msg.userId === currentUser?.id;
                    const convertedText = convertEmojis(msg.text);
                    status += '‚Ä¢ <strong>' + msg.username + '</strong>: "' + convertedText + '" (' + formatTime(msg.timestamp) + ')<br>';
                });
                
                status += '</div>';
                
                document.getElementById('messageStatus').innerHTML = status;
                
            } catch (error) {
                document.getElementById('messageStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) {
                return '—â–æ–π–Ω–æ';
            } else if (diff < 3600000) {
                const minutes = Math.floor(diff / 60000);
                return `${minutes} —Ö–≤ —Ç–æ–º—É`;
            } else {
                return date.toLocaleTimeString('uk-UA', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }
        }

        function updateMessagePreview() {
            try {
                const messages = JSON.parse(localStorage.getItem('chatMessages')) || [];
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                
                if (messages.length === 0) {
                    document.getElementById('messagePreview').innerHTML = 
                        '<div class="info">–ù–µ–º–∞—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É</div>';
                    return;
                }

                let preview = '<h4>–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å:</h4>';
                
                messages.slice(-3).forEach(msg => {
                    const isOwn = msg.userId === currentUser?.id;
                    const convertedText = convertEmojis(msg.text);
                    
                    preview += `
                        <div class="message-preview ${isOwn ? 'own-message' : ''}">
                            <div class="message-info">
                                <span class="message-username">${msg.username}</span>
                                <span class="message-time">${formatTime(msg.timestamp)}</span>
                            </div>
                            <div class="message-content">
                                ${convertedText}
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('messagePreview').innerHTML = preview;
                
            } catch (error) {
                document.getElementById('messagePreview').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≥–ª—è–¥—É: ' + error.message + '</div>';
            }
        }

        function openChat() {
            try {
                window.open('chat.html', '_blank');
                document.getElementById('chatStatus').innerHTML = 
                    '<div class="success">‚úÖ –ß–∞—Ç –≤—ñ–¥–∫—Ä–∏—Ç–æ –≤ –Ω–æ–≤—ñ–π –≤–∫–ª–∞–¥—Ü—ñ</div>';
            } catch (error) {
                document.getElementById('chatStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function openTestPage() {
            try {
                window.open('test_instagram_style.html', '_blank');
                document.getElementById('chatStatus').innerHTML = 
                    '<div class="success">‚úÖ –¢–µ—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª –≤—ñ–¥–∫—Ä–∏—Ç–æ</div>';
            } catch (error) {
                document.getElementById('chatStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function clearData() {
            try {
                localStorage.clear();
                document.getElementById('clearStatus').innerHTML = 
                    '<div class="success">‚úÖ –í—Å—ñ –¥–∞–Ω—ñ –æ—á–∏—â–µ–Ω–æ</div>';
                updateMessagePreview();
            } catch (error) {
                document.getElementById('clearStatus').innerHTML = 
                    '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        // Auto-update on load
        window.onload = function() {
            checkUsers();
            checkMessages();
            updateMessagePreview();
        };
    </script>
</body>
</html> 